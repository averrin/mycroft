<html>

<head>
    <script src="lib/jquery/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    Hello, my name is Adam Selen
    <ul id="events"></ul>


    <script>
        var ws = new WebSocket('ws://lets.developonbox.ru/mycroft/ws');
        ws.onopen = function() {
            console.log('WebSocket open');
        }
        ws.onmessage = function(event) {
            event = JSON.parse(event.data)
            var type = event.type;
            var msg = event.data;
            var status = event.status;
            var handler = {
                git: gitEvent,
                pulled: pulledEvent,
                info: infoEvent,
                tested: testedEvent,
                built: builtEvent,
            }[type]
            if(handler){
                handler(msg, status)
            }
        }

        function gitEvent(data){
            var li = $('<li></li>');
            li.html('New commit in repo: <strong>' + data.repository.name +
                '</strong> by ' + data.user_name +
                '<br> comment: "' + data.commits[0].message + '"');
            $('#events').append(li);
        }
        function pulledEvent(data){
            var li = $('<li></li>');
            li.html('Repo: <strong>' + data.repository.name +
                '</strong> was successfully updated.');
            $('#events').append(li);
        }

        function builtEvent(data, status){
            var li = $('<li></li>');
            li.addClass(status);
            li.html('Build result: ' + status);
            $('#events').append(li);
        }

        function testedEvent(data, status){
            var li = $('<li></li>');
            li.addClass(status);
            li.html('Tests result: ' + status);
            $('#events').append(li);
        }

        function infoEvent(data){
            var li = $('<li></li>');
            li.html('<strong>' + data.message +
                '</strong>');
            $('#events').append(li);
        }
    </script>
</body>

</html>
